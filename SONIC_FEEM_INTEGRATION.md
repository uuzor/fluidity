# Sonic FeeM Integration Guide

## Overview

Fluid Protocol is integrated with Sonic's Fee Monetization (FeeM) program, allowing the protocol to earn 90% of network fees generated by user interactions.

## Integration Details

### Contracts with FeeM Registration

All core Fluid Protocol contracts include the `registerForSonicFeeM()` function:

1. **SecureTroveManager** - Earns fees from liquidations and trove management
2. **SecureBorrowerOperations** - Earns fees from all borrowing operations
3. **USDF Token** - Earns fees from minting/burning operations
4. **SecureStabilityPool** - Earns fees from stability pool operations

### Fee Revenue Sources

The protocol generates fees from:

- **Trove Operations**: Opening, adjusting, and closing troves
- **Liquidations**: Liquidator transactions and redistribution
- **Token Operations**: USDF minting, burning, and transfers
- **Stability Pool**: Deposits, withdrawals, and offset operations
- **Oracle Updates**: Price feed interactions

## Deployment and Registration Process

### Step 1: Deploy to Sonic Network

```bash
# Deploy to Sonic testnet
npx hardhat run scripts/deploy-sonic.ts --network sonic-testnet

# Deploy to Sonic mainnet
npx hardhat run scripts/deploy-sonic.ts --network sonic-mainnet
```

### Step 2: Register Project on FeeM Dashboard

1. Visit [Sonic FeeM Dashboard](https://feem.sonic.game/)
2. Connect your admin wallet
3. Click "Apply for FeeM"
4. Fill out the registration form:
   - **Owner address**: Your admin wallet
   - **Rewards recipient**: Address to receive fee revenue
   - **Dispute contact**: Your email for support
   - **Metadata**: Project details (name, logo, website)

### Step 3: Register Contracts

After getting your Project ID from the dashboard:

```bash
# Register all contracts with FeeM
npx hardhat run scripts/register-feem.ts --network sonic-mainnet -- deployments-sonic-latest.json YOUR_PROJECT_ID
```

Or register manually by calling `registerForSonicFeeM(projectId)` on each contract.

### Step 4: Claim Revenue

- Visit the FeeM dashboard regularly to claim accumulated fees
- Fees are sent to the recipient address specified during registration
- Revenue is distributed as 90% to the protocol, 10% to Sonic network

## Revenue Optimization

### High-Fee Operations

Focus on operations that generate the most network fees:

1. **Complex Trove Operations**: Multi-step transactions
2. **Batch Liquidations**: Processing multiple troves
3. **Large Token Transfers**: High-value USDF operations
4. **Frequent Oracle Updates**: Real-time price feeds

### Gas Optimization

While earning fees, also optimize for user experience:

- Batch operations where possible
- Use efficient data structures
- Minimize external calls
- Implement circuit breakers for cost control

## Monitoring and Analytics

### Fee Tracking

Monitor your fee earnings through:

- Sonic FeeM dashboard
- On-chain analytics tools
- Custom monitoring scripts

### Key Metrics

Track these metrics for optimization:

- **Daily Fee Revenue**: Total fees earned per day
- **Fee per Transaction**: Average fee per user operation
- **User Activity**: Transaction volume and frequency
- **Gas Efficiency**: Cost per operation

## Smart Contract Integration

### Registration Function

Each contract includes this function:

```solidity
function registerForSonicFeeM(uint256 projectId) external onlyRole(ADMIN_ROLE) {
    (bool success,) = address(0xDC2B0D2Dd2b7759D97D50db4eabDC36973110830).call(
        abi.encodeWithSignature("selfRegister(uint256)", projectId)
    );
    require(success, "FeeM registration failed");
}
```

### Access Control

- Only admin role can register contracts
- Registration is one-time per contract
- Failed registrations can be retried

## Troubleshooting

### Common Issues

1. **Registration Failed**: Check admin permissions and Project ID
2. **No Fee Revenue**: Verify contract registration on dashboard
3. **Low Fees**: Optimize for high-gas operations

### Support

- Join [Sonic Builders Telegram](https://t.me/SonicBuilders)
- Contact Sam Harcourt for manual verification
- Check FeeM documentation for updates

## Revenue Projections

### Conservative Estimates

Based on typical DeFi usage:

- **Daily Transactions**: 1,000-10,000
- **Average Gas per TX**: 200,000-500,000
- **Gas Price**: 1-10 gwei
- **Daily Fee Revenue**: $50-$5,000

### Growth Scenarios

As protocol adoption increases:

- **High Activity**: $1,000-$10,000 daily
- **Institutional Use**: $10,000+ daily
- **Cross-chain Integration**: Additional revenue streams

## Best Practices

1. **Regular Claims**: Claim fees weekly to compound earnings
2. **User Education**: Inform users about fee benefits
3. **Gas Optimization**: Balance fees with user experience
4. **Monitoring**: Track metrics for optimization opportunities
5. **Community**: Engage with Sonic ecosystem for growth

## Contract Addresses

### Sonic FeeM Contracts

- **FeeM Core**: `0x0b5f073135df3f5671710f08b08c0c9258aecc35`
- **Projects Registrar**: `0x897d37f040Ec8DEFFD0ae1De743e1b1a14cf221f`
- **Contracts Registrar**: `0xDC2B0D2Dd2b7759D97D50db4eabDC36973110830`
- **Dispute Resolver**: `0xF2169D8A17aA40cc31e1b43E4FbB2d19CA099310`

### Network Information

- **Sonic Testnet**: Chain ID 64165
- **Sonic Mainnet**: Chain ID 146
- **RPC Testnet**: `https://rpc.testnet.soniclabs.com`
- **RPC Mainnet**: `https://rpc.soniclabs.com`

## Conclusion

Sonic FeeM integration provides a sustainable revenue model for Fluid Protocol while maintaining decentralization and user benefits. The 90% fee share creates strong incentives for protocol development and community growth.